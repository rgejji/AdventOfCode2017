package main

import (
	"fmt"
	"sort"
	"strings"
)

type direction = int
type element = int

const (
	//WEST is left
	WEST direction = iota
	//NORTH is up
	NORTH
	//EAST is right
	EAST
	//SOUTH is down
	SOUTH
)
const (
	//EMPTY is space
	EMPTY element = iota
	//H -
	H
	//V |
	V
	//FS /
	FS
	//BS \
	BS
	//PLUS +
	PLUS
)

//FSDir is the direction to go after hitting a forward slash
var FSDir = []direction{SOUTH, EAST, NORTH, WEST}

//BSDir is the direction to go after hitting a backward slash
var BSDir = []direction{NORTH, WEST, SOUTH, EAST}

//Cart is a cart object
type Cart struct {
	x         int
	y         int
	direction direction
	nextTurn  direction
	remove    bool
}

//Loc is grid location, it has a cart and underlying value
type Loc struct {
	value   element
	hasCart *Cart
}

//ByCarts implements sort.Interface based on the location
type ByCarts []*Cart

func (c ByCarts) Len() int { return len(c) }
func (c ByCarts) Less(i, j int) bool {
	if c[i].y < c[j].y {
		return true
	}
	if c[i].y == c[j].y && c[i].x < c[j].x {
		return true
	}
	return false

}
func (c ByCarts) Swap(i, j int) { c[i], c[j] = c[j], c[i] }

var grid [][]*Loc
var carts []*Cart

//Prints a grid with carts
func printGrid() {
	for _, row := range grid {
		for _, loc := range row {
			if loc.hasCart != nil {
				fmt.Printf("C")
				continue
			}
			switch loc.value {
			case H:
				fmt.Printf("-")
			case V:
				fmt.Printf("|")
			case FS:
				fmt.Print("/")
			case BS:
				fmt.Printf("\\")
			case PLUS:
				fmt.Printf("+")
			case EMPTY:
				fmt.Printf(" ")
			default:
				fmt.Printf("\nError: Unrecognized value %v\n", loc.value)
				return
			}
		}
		fmt.Printf("\n")
	}
	fmt.Printf("\n")
}

//Prints the cart locations
func printCarts() {
	for _, c := range carts {
		fmt.Printf("Cart at y=%d, x=%d with direction %v and next turn %v\n", c.y, c.x, c.direction, c.nextTurn)
	}
	fmt.Printf("\n")

}

//Read the input of the carts
func readInput() {
	rowSlice := strings.Split(inputStr, "\n")
	for y, row := range rowSlice {
		newGridRow := make([]*Loc, len(row), len(row))
		for x, r := range row {
			var cart *Cart
			var e element
			switch r {
			case '-':
				e = H
			case '|':
				e = V
			case '+':
				e = PLUS
			case '/':
				e = FS
			case '\\':
				e = BS
			case '>':
				e = H
				cart = &Cart{
					x:         x,
					y:         y,
					direction: EAST,
				}
				carts = append(carts, cart)
			case '<':
				e = H
				cart = &Cart{
					x:         x,
					y:         y,
					direction: WEST,
				}
				carts = append(carts, cart)
			case '^':
				e = V
				cart = &Cart{
					x:         x,
					y:         y,
					direction: NORTH,
				}
				carts = append(carts, cart)
			case 'v':
				e = V
				cart = &Cart{
					x:         x,
					y:         y,
					direction: SOUTH,
				}
				carts = append(carts, cart)
			}
			newGridRow[x] = &Loc{
				value:   e,
				hasCart: cart,
			}
		}

		grid = append(grid, newGridRow)
	}
	return
}

//Organize the carts with primary value vertical order, secondary value horizontal order
func sortCarts() {
	sort.Sort(ByCarts(carts))
}

//Updates the carts, checking for collisions during each update
func updateCartsInOrder() {
	for _, cart := range carts {
		if cart.remove {
			continue
		}

		currX := cart.x
		currY := cart.y

		//Get location
		loc := grid[currY][currX]

		//Figure out next location
		nextX := currX
		nextY := currY
		switch cart.direction {
		case WEST:
			nextX--
		case EAST:
			nextX++
		case NORTH:
			nextY--
		case SOUTH:
			nextY++
		}
		nextLoc := grid[nextY][nextX]

		//Check for collision
		if nextLoc.hasCart != nil {
			//Mark carts for removal, remove from grid and continue
			loc.hasCart.remove = true
			nextLoc.hasCart.remove = true
			loc.hasCart = nil
			nextLoc.hasCart = nil
			continue
		}
		//fmt.Printf("Moving from (y,x)=(%d, %d) to (%d, %d)\n", currY, currX, nextY, nextX)

		//Move cart on grid and slice
		cart.x = nextX
		cart.y = nextY
		loc.hasCart = nil
		nextLoc.hasCart = cart

		//Update direction
		switch nextLoc.value {
		case FS:
			cart.direction = FSDir[cart.direction]
		case BS:
			cart.direction = BSDir[cart.direction]
		case PLUS:
			cart.direction = (cart.direction + cart.nextTurn - 1 + 4) % 4
			cart.nextTurn = (cart.nextTurn + 1) % 3
		}
	}

	return
}

func cleanUpCarts() int {
	numRemoved := 0
	for i := len(carts) - 1; i >= 0; i-- {
		if carts[i].remove {
			copy(carts[i:], carts[i+1:])
			carts[len(carts)-1] = nil
			carts = carts[:len(carts)-1]
			numRemoved++
		}
	}
	return numRemoved
}

func main() {
	maxNumTurns := 1000000
	readInput()

	printCarts()
	for n := 0; n < maxNumTurns; n++ {
		sortCarts()
		updateCartsInOrder()
		numRemoved := cleanUpCarts()
		if numRemoved > 0 {
			fmt.Printf("%d: Removed %d carts\n", n, numRemoved)
		}

		if len(carts) == 0 {
			fmt.Printf("ERROR: Removed every cart\n")
			break
		}
		if len(carts) == 1 {
			fmt.Printf("Have 1 cart left\n")
			printCarts()
			return
		}
	}
}

/*
const inputStr = `/->-\
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   `
*/
const inputStr = `                                                                 /-----------------------------------------------------------------------\            
              /----------\                                       |                             /-----------------------------------------+---------\  
              |          |            /--------------------------+-----\ /---------------------+----------------------------------\      |         |  
            /-+----------+-----\      |                 /--------+-----+-+---------------------+----------------------------------+------+---\     |  
    /-------+-+--\       |     |      |                 |  /-----+-----+-+---------------------+-------------------\              |      |   |     |  
    |       | |  |       |     |      |                 |  |     |     | |   /-----------------+-\   /-------------+\             |      |   |     |  
    |       | |  |/------+-----+---\  |               /-+--+-----+-----+-+---+-----------------+-+---+---------\   ||             |      |   |     |  
    |       | |  ||      |     |   |  |             /-+-+--+----<+-----+-+---+-----------------+-+---+---------+---++-------------+----\ |   |     |  
    |       | |  ||      |    /+---+--+------------\| | |  |     |     | |   |                 | |   |         |   ||             |    | |   |     |  
    |       | |  ||      |    ||   |  |          /-++-+-+--+-----+-----+-+---+-----------------+-+---+---------+-\ ||             |    | |   |     |  
    |       | | /++------+----++---+--+----------+-++-+-+--+-----+-----+-+---+-----------------+-+---+-------\ | | ||             |    | |   |     |  
    |       | | |||      |/---++---+--+----------+-++-+-+--+\    |     | |   |                 | |   |       | | | ||             |    | |   |     |  
    |       | | |||      ||  /++---+--+----------+-++-+-+--++\   |     | |  /+----------\      | |   |       | | | ||             |    | |   |     |  
    |   /---+-+-+++------++--+++---+--+----------+-++-+-+--+++---+-\   | \--++----------+------+-+---+-------+-+-+-++-------------/    | |   |     |  
    |/--+---+-+-+++------++--+++---+--+--\      /+-++-+-+--+++---+-+---+----++----------+------+-+---+-------+-+-+-++------------------+-+\  |     |  
    ||  |   | | |||      ||  |||   | /+--+------++-++-+-+--+++---+-+---+----++--------\ |      | |   |   /---+-+-+-++------------------+-++--+-\   |  
    ||  |   | | |||      ||  |||  /+-++--+------++-++-+-+--+++---+-+\  |    ||        | |      | |   \---+---+-+-+-+/                  | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  /+-++--+----++--------+\|      | |      /+---+-+-+-+-------\           | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  || ||  |    ||     /--+++-----\| |      ||   | | | |       |           | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  || ||  |    ||     |  |||     || |      ||   | | | |       |       /---+-++--+-+--\|  
    ||/-+---+-+-+++\     ||  |||  || ||  |      || || | |/-+++--++-++--+----++-----+--+++-----++-+------++---+-+-+-+\      |       |   | ||  | |  ||  
    ||| |   | | ||||     ||  |||  || ||  |      || || | || |||  || ||  |    ||     | /+++-----++-+------++>--+-+-+-++-\    |       |   | ||  | |  ||  
    ||| \---+-+-++++-----++--+++--++-++--+------++-++-+-++-+++--++-/|  |    ||     | ||||     ||/+------++---+-+-+-++-+---\|       |   | ||  | |  ||  
    |||     | | ||||     ||  |||  || ||  |      || || | || |||  ||  |  |    ||     | ||||     ||||      ||   | | | || |   ||       |   | ||  | |  ||  
    |||     | | ||||     ||  |||  || ||  |/-----++-++-+-++-+++-\||  |  |    ||     | ||||     ||||      ||   | | | || |   ||       |   | ||  | |  ||  
    |||     | | ||||  /--++--+++--++-++--++-----++-++-+-++-+++-+++--+--+----++-----+-++++-----++++------++---+-+-+-++-+---++------\|   | ||  | |  ||  
    \++-----+-+-+/||  |  ||  |||  || |\--++-----++-++-+-++-+++-+++--+--/    ||     | ||||     ||||      ||   | | | || |   ||      ||   | ||  | |  ||  
     ||     | | | ||  |  ||  |||  || |   ||     v| || | || ||| |||  |       ||     | ||||     ||||      ||   | | | || |   ||    /-++---+-++--+-+-\||  
     ||     | | | ||  |  ||  |||  || |   ||     || ||/+-++-+++-+++--+-\     ||     | ||||     ||||      ||   | | | || |   ||    | ||   | ||  | | |||  
     ||     | | | ||  |  ||  |\+--++-+---++-----++-/||| || ||| |||  | |     ||     | ||||     ||||      ||   | |/+-++-+---++----+-++---+-++--+\| |||  
     ||     | | | ||  |  ||  | |  || |   ||     ||  ||| || ||| |||  | |     ||     | ||||     ||||      \+---+-+++-++-+---+/    | ||   | ||  ||| |||  
     ||/----+-+-+-++--+--++--+-+--++-+---++-----++--+++-++-+++-+++--+-+-----++-----+-++++---\ ||||  /----+---+-+++-++-+---+-----+-++---+-++-\||| |||  
     |||  /-+-+-+-++--+--++--+-+--++-+---++-----++--+++-++-+++-+++--+-+-----++-----+-++++---+-++++--+----+--\| ||| || |   |     | |\---+-++-++++-+/|  
     |||  | | | | ||  |  ||  | |  || |   ||     ||  ||| || ||| |||  | |    /++-----+-++++---+-++++--+----+--++-+++-++-+---+-----+-+-\  | || |||| | |  
     |||  | | \-+-++--+--/|  | |  || |   ||     ||  ||| || ||| |||  | |    |||     | ||||   | ||||  |    |  || ||| || |   |     | | |  | || |||| | |  
     |||  | |   | ||  |   |  | |  || |   ||     ||  ||| || ||| |||  | |    |||     | ||||   | |\++--+----+--++-+++-++-+---+-----+-+-+--+-++-++++-+-/  
     |||  | \---+-++--+---+--+-/  || |   |\-----++--+++-++-+++-/||  | |    |||     | ||||   | | ||  |    |  || ||| || |   |     | | |  | || |||| |    
     |||  | /---+-++--+---+--+\   \+-+---+------++--+++-++-+++--++--/ |  /-+++-----+-++++---+-+-++--+--\ |  || ||| || |   |     | | |  | || |||| |    
     \++--+-+---+-++--+---+--++----+-+---/      ||  ||| || |||  ||    |/-+-+++-----+-++++---+-+-++--+--+-+--++-+++-++-+---+-----+-+-+--+-++-++++-+---\
      ||  | |/--+-++--+---+-\||    | |          ||  ||| || |||  ||    || | |||     | ||||   | | ||  |  | |  || ||| || |   |     | | |  | || |||| |   |
      ||  | ||  | ||  |   | |||    | |  /-------++--+++-++-+++--++----++-+-+++-----+-++++---+-+-++--+--+-+--++\||| || |   |     | | |  | || |||| |   |
     /++--+-++--+-++--+---+-+++----+-+--+-------++--+++-++-+++--++----++-+-+++\    | ||||   | | || /+--+-+--++++++-++-+---+-----+-+-+\ | || |||| |   |
     |||  | || /+-++--+---+-+++----+-+--+---\   ||  ||| || |||  ||    || | ||||    | ||||   | | || ||  | |  |||||| || |   |     | | || | || |||| |   |
    /+++--+-++-++-++--+---+-+++----+-+--+---+---++--+++-++-+++--++----++-+\||||    | ||||   | | || ||  |/+--++++++-++-+<--+---\ | | || | || |||| |   |
    ||||  | || || ||  |   | |||    | | /+---+---++--+++-++-+++--++----++-++++++----+-++++---+-+-++-++--+++--++++++-++-+---+---+-+\| || | || |||| |   |
    |||| /+-++-++-++--+---+-+++----+-+-++---+---++--+++-++-+++--++----++-++++++--\ | ||||   | | || || /+++--++++++-++-+---+---+-+++-++\| || |||| |   |
    |||| ||/++-++-++--+---+-+++----+-+-++-\ |   ||  ||| || ||| /++----++-++++++--+-+-++++---+-+-++-++-++++--++++++-++-+---+---+-+++-++++-++-++++\|   |
    ||\+-+++++-++-+/  |   | |||    | | || | |  /++--+++-++-+++-+++----++-++++++--+-+-++++---+-+-++-++-++++--++++++-++-+---+---+-+++-++++\|| ||||||   |
/---++-+-+++++-++-+---+---+-+++----+-+-++-+-+--+++--+++-++-+++-+++----++-++++++--+-+-++++---+-+-++-++\||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | ||||| || |   |   | |||  /-+-+-++-+\|  |||  ||| || ||| |||    || ||||||  | | ||||   | | || |||||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | |^||| || |   |   | |||  | | | || |||  |||  ||| || ||| |||    || ||||\+--+-+-++++---+-+-+/ |||||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | ||||| || |   |  /+-+++--+-+-+-++-+++--+++--+++-++-+++-+++----++-++++-+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--\| ||| ||||||| ||||||   |
|   || | ||||| || |   |  || |||  | | | || |||  |||  ||| || ||| |||    |\-++++<+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--++-+++-+++++++-++++++---/
|   || | ||||| || |   |  || |||  | | | || |||  |||  ||| ||/+++-+++----+--++++-+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--++\||| ||||||| |v||||    
|   || | ||||| \+-+---+--++-+++--+-+-+-++-++/  |||  ||| |||||| |||    |  |||| |  | | ||||   | | |  |||||||  |||||| || |   |  |||||| ||||||| ||||||    
|   || | |||||  | |   |  || |||  | | |/++-++---+++--+++-++++++-+++-\  |  |||| |  | | ||||   | | |  |||||||  |||||| || |   |  |||||| ||||||| ||||||    
|   || | |||||  | |   |  || |||  | | |||| ||   |||  ||| |||||| ||| |  |  |||| |  | \-++++---+-/ |  |||||||  |||||| || |   |  |||\++-+++++++-+++++/    
|   || | |||||  ^ |   |  || |\+--+-+-++++-++---+++--+++-+++++/ ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||| || |   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||| || |   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||^ || v   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  ||||||\--++++++-++-+---+--+++-++-+++++++-+++/|     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |/-+--++++-+--+---++++---+---+--++++++---++++++-++-+---+--+++-++-+++++++-+++-+-\   
|   || | ||||| /+-+---+--++-+-+--+-+-++++-++--\|||  ||\-+++++--+++-++-+--++++-+--+---++++---+---+--++++++---+++/|| || | /-+--+++-++-+++++++-+++-+-+--\
|   || | ||||| || |   |  || | |  | | |||| ||  ||||  ||/-+++++--+++-++-+--++++-+-\|   ||||   |   |  ||||||   ||| || || | | |  ||| || ||||||| ||| | |  |
|   || | ||||| || |   |  ||/+-+--+-+-++++-++--++++--+++-+++++--+++-++-+--++++-+-++---++++---+---+--++++++---+++-++-++-+-+\|  ||| || ||||||| ||| | |  |
| /-++-+-+++++-++-+---+--++++-+--+-+-++++-++--++++--+++-+++++--+++-++\|  |||| | ||   ||||   |   |  ||||||   ||| \+-++-+-+++--+++-++-+++++++-++/ | |  |
| | || | ||||| || |   |  |||| |  | | |||| ||/-++++--+++-+++++--+++-++++--++++-+-++---++++--\|   |  ||||||   |||  | || | |||  ||| || ||||||| ||  | |  |
| | || | ||||| || |   |  |||| |  | | |||| ||| ||||  ||| |||||  ||| ||||  |||\-+-++---+++/  ||   |  |||\++---+++--+-++-+-+++--+++-++-++/|||| ||  | |  |
| | || | ||||| || |   |  ||||/+--+-+-++++-+++-++++--+++-+++++--+++-++++--+++--+-++---+++---++---+--+++-++---+++--+-++-+-+++\ ||| || || |||| ||  | |  |
| | || | ||||| || |   |  ||||||  | | |||| ||| ||||  ||| |||||  ||| ||||  |||  | ||   |||   ||   |  \++-++---+++--+-++-+-++++-+++-++-+/ |||| ||  | |  |
| | || | ||||| || \---+--++++++--+-/ |||| ||| |\++--+++-+++++--+++-++++--+++--+-++---+++---++---+---++-++---+++--+-++-+-++++-+++-++-+--+/|| ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| | \+--+++-+++++--+++-++++--+++--+-++---+++---++---+---++-++---+++--+-++-+-++++-+++-++-+--+-+/ ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| |  |/-+++-+++++--+++-++++--+++--+-++---+++--\||   |   || ||   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| |  || ||| |||||  ||| ||||  \++--+-++---+++--+++---+---++-/|   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | ||\++-++-----+--++++++--+---++++-/|| |  || ||| |||||  ||| ||||  /++--+-++---+++--+++---+\  ||  |   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | || || ||     |  ||||||  |   ||||  || |  || ||| |||||  ||| |\++--+++--+-++---+++--+++---++--++--+---+++--+-++-+-++++-+++-++-+--+-+--++--+-/  |
| | || |/++-++-++-----+--++++++--+---++++--++\|  || ||| |||\+--+++-+-++--+++--+-++---+++--+++---++--++--+---+++--+-/| | |||| ||| || |  | |  ||  |    |
| | || |||| || ||     |  ||||||  |   ||\+--++++--++-+++-+++-+--+++-+-++--+++--+-++---+++--+++---++--++--+---+++--+--+-+-++++-+++-/| |  | |  ||  |    |
| | || |||| \+-++-----+--+++++/  |   || |  ||||  || ||| ||| |  ||| | ||  |||  | ||   |||  |||   ||  ||  | /-+++--+--+-+-++++-+++--+\|  | |  ||  |    |
| | || ||||  | ||     |  |||||   |   || |  ||||  \+-+++-+++-+--+++-+-++--+++--+-++---+++--+++---++--++--+-+-+++--/  | | |||| |||  |||  | |  ||  |    |
| | || ||||  | ||     |  |||||   |  /++-+--++++---+\|\+-+++-+--+++-+-+/  |||  | ||   |||  |||   ||  ||  | | |v|     | | |||| |||  |||  | |  ||  |    |
| | || ||||  | ||     |  |||||   |  ||| |  ||||   ||| | ||| |  ||| | |   |||  | ||   ||| /+++---++--++--+-+-+++-----+-+-++++-+++--+++--+-+-\||  |    |
| | || |||\--+-++-----+--+++++---+--+++-+--++++---+++-+-+++-+--+++-+-+---+++--+-++---+++-++++---++--++--+-+-/||     | | |||| |||  |||  | | |||  |    |
| | || |||   | ||     |  |||||   |  ||| |  ||||/--+++-+-+++-+--+++-+-+---+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-+-+++--+---\|
| | || |||   | ||     |  |\+++---+--+++-+--+++++--+++-+-+++-/  ||| | |   |||  | ||   ||| ||||   ||  ||  | |  ||     | | |||| |||  |||  | | |||  |   ||
| | || |||   | ||     |  | |||   |  ||| |  |||||  ||| | |||    ||| | | /-+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-+-+++\ |   ||
| | || |||   | ||     |  | |||   |  ||| |  |||||  ||| | |||    ||\-+-+-+-+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-/ |||| |   ||
| | || |||   | ||/----+--+-+++---+--+++-+--+++++--+++-+-+++----++--+-+-+-+++--+-++---+++-++++---++--++-\| |  ||     | | |||| |||  |||  |   |||| |   ||
| | || |||   | |||    |  | |||   |  ||| |  |||||  ||| | |||    ||  | | | ||| /+-++---+++-++++---++--++-++-+--++-----+-+-++++-+++--+++\ |   |||| |   ||
| | || |||   | \++----+--+-+++---+--+++-+--+++/|  ||| | \++----++--+-+-+-+++-++-++---+++-++++---++--++-++-+--++-----+-+-++++-+++--++++-+---++/| |   ||
| | || |||   |/-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+-+++-++-++---+++-++++---++--++-++-+-\||     | | |||| |||  |||| |   || | |   ||
| | || |||   || ||    |  | |||   |  ||| |  ||| |  ||| |  ||    ||  | | |/+++-++-++---+++-++++--\||  || || | |||     | | |||| |||  |||| |   || | |   ||
| | |\-+++---++-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+++++-+/ ||   ||| ||||  |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |/+--+++---++-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+++++-+--++---+++-++++\ |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||    | /+-+++---+--+++-+--+++-+--+++-+--++----++-\| | ||||| |  ||   ||| ||||| |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||    | || |||   |  ||| |  ||| |  ||| |  ||    |\-++-+-+++++-+--++---++/ ||||| |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||  /-+-++-+++---+--+++-+-\||| |  ||| |  ||    |  || | |||||/+--++---++--+++++-+++--++-++-+\|||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||  | | ||/+++---+--+++-+-++++-+--+++-+-\||    |  || | |||||||  ||   \+--+++++-+++--++-++-+++++-----+-/ |||| |||  ||||/+---++-+-+-\ ||
| |||  |||   || ||  | | ||||||   |  ||| | |||| |  \++-+-+++----+--++-+-+++++++--++----+--+/||| |||  || || |||||     |   |||| |||  ||||||   || | | | ||
| |||  ||v   || ||  | | ||||||   |  ||| | |||| |   || | |||    |  || | \++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--++++++---++-/ | | ||
|/+++--+++---++-++--+-+\||||||   |  ||| | |||| |   || | |||    |  || |  ||||||  ||    |  | ||| |||  || || |||||     |   |||| |||  ||||||   ||   | | ||
|||||  |||   || ||  | ||||||||   |  ||| | |||| |   |\-+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--+++++/   ||   | | ||
|||||  |||   || ||  | \+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--/||||    ||   | | ||
|||||  |||   || ||  |/-+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+\  |||| |||   ||||    ||   | | ||
|||||  |||   || \+--++-+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++/|     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  ||| | |||| |   |  | |||    |  || |  ||||||  ||    |  | ||| |||  || || ||| |     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  |\+-+-++++-+---+--+-+++----+--++-+--++++++--++----/  | ||| |||  || || ||| |     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  \-+-+-++++-+---/  \-+++----+--++-+--++++++--/|       | ||| |\+--++-++-+++-+-----++--++/| |||   ||||    ||   | | ||
||\++--+++---++--+--++-+++++++---+----+-+-++++-+--------+++----+--++-/  ||||||   |   /---+-+++-+-+--++-++-+++-+-----++-\|| |/+++---++++----++--\| | ||
|| ||  |||  /++--+--++-+++++++---+----+-+-++++-+--------+++----+--++----++++++---+---+---+-+++-+-+--++-++-+++-+----\|| ||| |||||   ||||    ||  || | ||
|| ||  |||  |||  |  || |||||||   |    | \-++++-+--------+++----+--++----++++++---+---+---+-+++-+-+--++-++-+++-/    ||| ||| |||||   ||||    ||  || | ||
|| ||  ^\+--+++--+--++-+++++++---+----+---+++/ |        |||    |  ||    ||||||   |   |   | ||| | |  || |\-+++------+++-+++-+++/|   ||||    ||  || | ||
|| ||  | |  |||  |  || |||||||   |    |   |||  |        |||    |  ||    ||||||   |   |   | ||| | |  || |  |||      ||| ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |  \+-+++++++---+----+---/||  |        |\+----+--++----++++++---+---+---+-+++-+-+--++-+--+++------+/| ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |   | |||||||   |    |    ||  |        | |    |  ||   /++++++---+--\|   | ||| | |  || |  |||      | | ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |   \-+++++++---+----+----++--+--------+-+----+--++---+++++++---+--++---+-+++-+-+--++-+--+++------+-/ ||| ||| |   ||||    ||  || | ||
|| ||  \-+--+++--+-----+++++++---+----+----++--+--------+-+----+--++---+++++++---+--++---+-+/| | |  \+-+--+++------+---+++-+++-+---++++----+/  || | ||
|\-++----+--+++--+-----/||||||   |    |    ||  |        | |    |  ||   |||||||   |  |\---+-+-+-+-+---+-+--+++------+---/|| ||| |   ||||    |   || | ||
|  ||    |  |||  |      ||||||   |    |    ||  |        | |    |  ||   ||||||\---+--+----+-+-+-+-+---+-+--+++------+----++-+++-+---++/|    |   || | ||
|  ||    |  |||  |      |\++++---+----+----++--+--------+-+----+--++---++++++----+--+----+-+-+-+-+---+-+--+++------+----++-++/ |   || |    |   || | ||
|  ||    |  |||  |   /--+-++++---+----+----++--+--------+-+----+--++---++++++--\ |  |    | | | | |   | |  |||      |    || ||  |   || |    |   || | ||
|  ||    |  |||  |   |  | ||||   |    |    |\--+--------+-+----+--++---++++++--+-+--+----+-/ | | |   | |  ||v      |    || ||  |   || |    |   || | ||
|  ||    |  |||  \---+--+-++++---+----+----+---+--------+-+----+--++---++++++--+-+--+----+---+-+-+---+-/  |||      |    || ||  |   || |    |   || | ||
|  ||    |  |||      |  | |\++---+----+----+---+--------+-+----+--++---++++++--+-+--+----+---+-+-+---+----+++------+----+/ ||  |   || |    |   || | ||
|  ||    |  |||      |  | | ||   |    |   /+---+--------+-+-\  |  || /-++++++--+-+--+---<+---+-+-+---+----+++------+----+-\||  |   || |    |   || | ||
|  ||    |  |||      |  | | ||   |    |   ||   |        | | |  |  || | ||||\+--+-+--+----+---+-+-+---+----+++------+----+-+++--+---+/ |    |   || | ||
|  ||    |  |||      |  \-+-++---+----+---++---+--------+-+-+--+--/| | |||| |  | |  |    |   | | |   |    |||      |    | |||  |   |  |    |   || | ||
|  ||    |  |\+------+----+-/|   |    |   ||   |        | | |  |   | | |||| |  | |  |    |   | | |   |/---+++------+\   | |||  |   |  |    |   || | ||
|  ||    |  | |      |    |  |   |    |   ||   |        | | |  |   | | |||| |  | |  |    |   | | |   ||   |||      ||   \-+++--+---+--+----+---++-+-+/
|  ||    |  \-+------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---++---+++------/|     |||  |   |  |    |   || | | 
|  ||    |    \------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---++---++/       |     |||  |   |  |    |   || | | 
\--++----+-----------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---/|   ||        |     |||  |   |  |    |   || | | 
   ||    \-----------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-/  |    |   | | |    |   ||        |     |||  |   |  |    |   || | | 
   ||                |    |  \---+----+---++---+--------+-+-+--+---+-+-++++-+--+----+----+---+-+-+----+---++--------+-----+/|  |   |  |    |   || | | 
   ||                |    |      |    |   ||   |        | | |  |   | | |||| |  |    |    \---+-+-+----+---++--------+-----+-+--+---+--+----/   || | | 
   |\----------------+----+------+----+---++---+--------+-+-+--+---+-+-+++/ |  |    |        | | |    |   \+--------+-----+-+--+---/  |        || | | 
   |        /--------+----+------+----+---++---+----<---+-+-+--+---+-+-+++--+--+----+--------+-+-+----+----+--------+\    | |  |      |        || | | 
   |        |        |    |      \----+---+/   |        | | |  |   | | |\+--+--+----+--------+-/ |    |    |        ||    | |  |      |        || | | 
   |        |        |    |           |   |    \--------+-+-+--+---+-+-+-+--+--+----+--------+---+----+----+--------++----+-+--+------+--------++-+-/ 
   \--------+--------+----+-----------+---+-------------+-+-+--+---+-+-+-+--+--+----+--------/   |    |    |        ||    | |  |      |        || |   
            |        |    |           |   |             | | |  |   | | \-+--+--+----/            |    |    |        ||    | |  |      |        || |   
            |        |    |           |   |             | | |  |   | |   |  |  |                 |    |    |        ||    | \--+------+--------/| |   
            |        |    |           \---+-------------+-+-+--+---/ |   |  |  |                 |    \----+--------/|    |    |      |         | |   
            |        |    |               |             | | |  |     |   \--+--+-----------------/         |         |    |    |      |         | |   
            |        |    |               |             | | |  \-----+------+--+---------------------------+---------+----+----+------+---------/ |   
            |        |    |               \-------------+-+-/        |      \--+---------------------------/         |    |    |      |           |   
            |        |    |                             | |          \---------+-------------------------------------+----/    |      \-----------/   
            \--------+----+-----------------------------+-+--------------------+-------------------------------------/         |                      
                     \----+----------->-----------------+-+--------------------/                                               |                      
                          \-----------------------------/ \--------------------------------------------------------------------/                      `
